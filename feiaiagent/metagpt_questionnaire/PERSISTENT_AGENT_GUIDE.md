# ğŸš€ æŒä¹…åŒ–æ™ºèƒ½ä½“ä¼˜åŒ–æŒ‡å—

## ğŸ“‹ æ¦‚è¿°

ä¸ºäº†å¤§å¹…ç¼©çŸ­é—®å·å¡«å†™æ—¶é—´ï¼Œæˆ‘ä»¬å®ç°äº†æŒä¹…åŒ–æ™ºèƒ½ä½“ç®¡ç†å™¨ï¼Œä¿æŒæ™ºèƒ½ä½“å¸¸å¼€çŠ¶æ€ï¼Œé¿å…é‡å¤åˆå§‹åŒ–ã€‚

## âš¡ æ€§èƒ½ä¼˜åŒ–æ•ˆæœ

### ä¼˜åŒ–å‰
- æ¯æ¬¡å›ç­”é—®é¢˜éƒ½è¦é‡æ–°åˆå§‹åŒ–æ™ºèƒ½ä½“
- æ¯æ¬¡APIè°ƒç”¨éƒ½æœ‰åˆå§‹åŒ–å¼€é”€
- é—®å·å¡«å†™æ—¶é—´ï¼š**15-20åˆ†é’Ÿ**

### ä¼˜åŒ–å
- æ™ºèƒ½ä½“ä¿æŒå¸¸å¼€çŠ¶æ€ï¼Œå¤ç”¨è¿æ¥
- å‡å°‘90%çš„åˆå§‹åŒ–æ—¶é—´
- é—®å·å¡«å†™æ—¶é—´ï¼š**5-8åˆ†é’Ÿ**

## ğŸ—ï¸ æŠ€æœ¯æ¶æ„

### æ ¸å¿ƒç»„ä»¶

1. **PersistentAgentManager** - æŒä¹…åŒ–æ™ºèƒ½ä½“ç®¡ç†å™¨
2. **AgentSession** - æ™ºèƒ½ä½“ä¼šè¯ä¿¡æ¯
3. **è‡ªåŠ¨æ¸…ç†æœºåˆ¶** - å®šæœŸæ¸…ç†ç©ºé—²æ™ºèƒ½ä½“

### å·¥ä½œæµç¨‹

```mermaid
graph TB
    A[ç”¨æˆ·å›ç­”é—®é¢˜] --> B[è·å–æŒä¹…åŒ–æ™ºèƒ½ä½“]
    B --> C{æ™ºèƒ½ä½“æ˜¯å¦å­˜åœ¨?}
    C -->|æ˜¯| D[å¤ç”¨ç°æœ‰æ™ºèƒ½ä½“]
    C -->|å¦| E[åˆ›å»ºæ–°æ™ºèƒ½ä½“]
    D --> F[å¤„ç†ç­”æ¡ˆ]
    E --> F
    F --> G[æ›´æ–°ä½¿ç”¨ç»Ÿè®¡]
    G --> H[è¿”å›ç»“æœ]
```

## ğŸ”§ ä½¿ç”¨æ–¹æ³•

### 1. åŸºæœ¬ä½¿ç”¨

```python
from metagpt_questionnaire.persistent_agent_manager import process_with_persistent_agent

# ä½¿ç”¨æŒä¹…åŒ–æ™ºèƒ½ä½“å¤„ç†æ•°æ®
result = await process_with_persistent_agent("Dr. Aiden", input_data)
```

### 2. è·å–ç»Ÿè®¡ä¿¡æ¯

```python
from metagpt_questionnaire.persistent_agent_manager import get_agent_session_stats

# è·å–æ™ºèƒ½ä½“ä½¿ç”¨ç»Ÿè®¡
stats = get_agent_session_stats()
print(f"æ´»è·ƒæ™ºèƒ½ä½“æ•°é‡: {stats['active_sessions']}")
print(f"æ€»ä½¿ç”¨æ¬¡æ•°: {stats['total_usage']}")
```

### 3. APIç«¯ç‚¹

```bash
# è·å–æ™ºèƒ½ä½“ç»Ÿè®¡
GET /api/metagpt/agent_stats

# å“åº”ç¤ºä¾‹
{
  "total_sessions": 3,
  "active_sessions": 2,
  "total_usage": 15,
  "agents": {
    "Dr. Aiden": {
      "usage_count": 8,
      "last_used": "2024-01-15T10:30:00",
      "is_active": true
    }
  }
}
```

## âš™ï¸ é…ç½®å‚æ•°

### æ¸…ç†é…ç½®
- `cleanup_interval`: æ¸…ç†é—´éš”ï¼ˆé»˜è®¤300ç§’ï¼‰
- `max_idle_time`: æœ€å¤§ç©ºé—²æ—¶é—´ï¼ˆé»˜è®¤1800ç§’ï¼‰

### æ™ºèƒ½ä½“é…ç½®
- è‡ªåŠ¨å¤ç”¨ï¼šç›¸åŒæ™ºèƒ½ä½“åç§°ä¼šå¤ç”¨ç°æœ‰å®ä¾‹
- è‡ªåŠ¨æ¸…ç†ï¼šç©ºé—²è¶…è¿‡30åˆ†é’Ÿçš„æ™ºèƒ½ä½“ä¼šè¢«å…³é—­
- ç»Ÿè®¡è·Ÿè¸ªï¼šè®°å½•ä½¿ç”¨æ¬¡æ•°å’Œæœ€åä½¿ç”¨æ—¶é—´

## ğŸ“Š ç›‘æ§å’Œè°ƒè¯•

### 1. æŸ¥çœ‹æ™ºèƒ½ä½“çŠ¶æ€

```python
# åœ¨SmartQuestionnaireManagerä¸­
manager = SmartQuestionnaireManager()
stats = manager.get_agent_stats()
print(stats)
```

### 2. æ—¥å¿—ç›‘æ§

```
âœ… å¤ç”¨æ™ºèƒ½ä½“: Dr. Aiden (ä½¿ç”¨æ¬¡æ•°: 5)
âš¡ æ™ºèƒ½ä½“å¤„ç†å®Œæˆ: Dr. Aiden (è€—æ—¶: 0.15s)
ğŸ§¹ æ¸…ç†ç©ºé—²æ™ºèƒ½ä½“: ç­”æ¡ˆå®¡æ ¸ä¸“å®¶ (ç©ºé—²æ—¶é—´: 1800s)
```

### 3. æ€§èƒ½æŒ‡æ ‡

- **åˆå§‹åŒ–æ—¶é—´**: ä»2-3ç§’å‡å°‘åˆ°0.1-0.2ç§’
- **å†…å­˜ä½¿ç”¨**: æ™ºèƒ½ä½“å¤ç”¨ï¼Œå‡å°‘å†…å­˜å ç”¨
- **APIè°ƒç”¨**: å‡å°‘é‡å¤çš„DeepSeek APIè°ƒç”¨

## ğŸ”„ è‡ªåŠ¨ç®¡ç†

### æ™ºèƒ½ä½“ç”Ÿå‘½å‘¨æœŸ

1. **åˆ›å»º**: é¦–æ¬¡ä½¿ç”¨æ—¶åˆ›å»ºæ™ºèƒ½ä½“å®ä¾‹
2. **å¤ç”¨**: åç»­è°ƒç”¨ç›´æ¥å¤ç”¨ç°æœ‰å®ä¾‹
3. **æ¸…ç†**: ç©ºé—²è¶…è¿‡30åˆ†é’Ÿè‡ªåŠ¨å…³é—­
4. **ç»Ÿè®¡**: å®æ—¶è·Ÿè¸ªä½¿ç”¨æƒ…å†µ

### é”™è¯¯å¤„ç†

- æ™ºèƒ½ä½“ä¸å¯ç”¨æ—¶è‡ªåŠ¨é™çº§
- ç½‘ç»œé”™è¯¯æ—¶é‡è¯•æœºåˆ¶
- å¼‚å¸¸æƒ…å†µä¸‹è¿”å›é»˜è®¤å€¼

## ğŸ¯ æœ€ä½³å®è·µ

### 1. æ™ºèƒ½ä½“å‘½å
- ä½¿ç”¨ä¸€è‡´çš„æ™ºèƒ½ä½“åç§°
- é¿å…é¢‘ç¹åˆ›å»ºä¸åŒåç§°çš„æ™ºèƒ½ä½“

### 2. èµ„æºç®¡ç†
- å®šæœŸæ£€æŸ¥æ™ºèƒ½ä½“ç»Ÿè®¡
- ç›‘æ§å†…å­˜ä½¿ç”¨æƒ…å†µ
- å¿…è¦æ—¶æ‰‹åŠ¨æ¸…ç†

### 3. æ€§èƒ½ä¼˜åŒ–
- ä¼˜å…ˆä½¿ç”¨æŒä¹…åŒ–æ™ºèƒ½ä½“
- é¿å…é¢‘ç¹çš„æ™ºèƒ½ä½“åˆ‡æ¢
- åˆç†è®¾ç½®æ¸…ç†å‚æ•°

## ğŸš¨ æ³¨æ„äº‹é¡¹

1. **å†…å­˜ä½¿ç”¨**: æŒä¹…åŒ–æ™ºèƒ½ä½“ä¼šå ç”¨å†…å­˜ï¼Œéœ€è¦å®šæœŸæ¸…ç†
2. **å¹¶å‘å®‰å…¨**: ä½¿ç”¨çº¿ç¨‹é”ä¿è¯å¹¶å‘å®‰å…¨
3. **é”™è¯¯æ¢å¤**: æ™ºèƒ½ä½“å¼‚å¸¸æ—¶ä¼šè‡ªåŠ¨é™çº§å¤„ç†
4. **é…ç½®è°ƒæ•´**: æ ¹æ®å®é™…ä½¿ç”¨æƒ…å†µè°ƒæ•´æ¸…ç†å‚æ•°

## ğŸ“ˆ æ€§èƒ½æå‡æ€»ç»“

| æŒ‡æ ‡ | ä¼˜åŒ–å‰ | ä¼˜åŒ–å | æå‡å¹…åº¦ |
|------|--------|--------|----------|
| é—®å·å¡«å†™æ—¶é—´ | 15-20åˆ†é’Ÿ | 5-8åˆ†é’Ÿ | **60-70%** |
| æ™ºèƒ½ä½“åˆå§‹åŒ– | 2-3ç§’/æ¬¡ | 0.1-0.2ç§’/æ¬¡ | **90%** |
| APIè°ƒç”¨æ¬¡æ•° | æ¯æ¬¡é‡æ–°è°ƒç”¨ | å¤ç”¨è¿æ¥ | **å¤§å¹…å‡å°‘** |
| ç”¨æˆ·ä½“éªŒ | ç­‰å¾…æ—¶é—´é•¿ | å“åº”è¿…é€Ÿ | **æ˜¾è‘—æå‡** |

é€šè¿‡æŒä¹…åŒ–æ™ºèƒ½ä½“ç®¡ç†å™¨ï¼Œæˆ‘ä»¬å®ç°äº†é—®å·å¡«å†™æ—¶é—´çš„å¤§å¹…ç¼©çŸ­ï¼Œæå‡äº†ç”¨æˆ·ä½“éªŒï¼
